from __future__ import annotations

import pandas as pd

from bedrock.extract.allocation.bea import load_bea_use_table
from bedrock.extract.allocation.epa import (
    load_recent_trends_in_ghg_emissions_and_sinks,
)
from bedrock.utils.economic.units import MEGATONNE_TO_KG
from bedrock.utils.taxonomy.bea.ceda_v7 import CEDA_V7_SECTORS


def allocate_other_process_uses_of_carbonates() -> pd.Series[float]:
    allocation_sectors = [
        "321100",
        "321200",
        "321910",
        "3219A0",
        "327100",
        "327200",
        "327310",
        "327320",
        "327330",
        "327390",
        "327400",
        "327910",
        "327991",
        "327992",
        "327993",
        "327999",
        "331110",
        "331200",
        "331313",
        "331410",
        "331420",
        "331490",
        "331510",
        "331520",
        "332114",
        "33211A",
        "332119",
        "332200",
        "332310",
        "332320",
        "332410",
        "332420",
        "332430",
        "332500",
        "332600",
        "332710",
        "332720",
        "332800",
        "332913",
        "33291A",
        "332991",
        "332996",
        "33299A",
        "332999",
        "333111",
        "333112",
        "333120",
        "333130",
        "333242",
        "33329A",
        "333314",
        "333316",
        "333318",
        "333414",
        "333415",
        "333413",
        "333511",
        "333514",
        "333517",
        "33351B",
        "333611",
        "333612",
        "333613",
        "333618",
        "333912",
        "333914",
        "333920",
        "333991",
        "333993",
        "333994",
        "33399A",
        "33399B",
        "334111",
        "334112",
        "334118",
        "334210",
        "334220",
        "334290",
        "334413",
        "334418",
        "33441A",
        "334510",
        "334511",
        "334512",
        "334513",
        "334514",
        "334515",
        "334516",
        "334517",
        "33451A",
        "334300",
        "334610",
        "335110",
        "335120",
        "335210",
        "335221",
        "335222",
        "335224",
        "335228",
        "335311",
        "335312",
        "335313",
        "335314",
        "335911",
        "335912",
        "335920",
        "335930",
        "335991",
        "335999",
        "336111",
        "336112",
        "336120",
        "336211",
        "336212",
        "336213",
        "336214",
        "336310",
        "336320",
        "336350",
        "336360",
        "336370",
        "336390",
        "3363A0",
        "336411",
        "336412",
        "336413",
        "336414",
        "33641A",
        "336500",
        "336611",
        "336612",
        "336991",
        "336992",
        "336999",
        "337110",
        "337121",
        "337122",
        "337127",
        "33712N",
        "337215",
        "33721A",
        "337900",
        "339112",
        "339113",
        "339114",
        "339115",
        "339116",
        "339910",
        "339920",
        "339930",
        "339940",
        "339950",
        "339990",
        "311111",
        "311119",
        "311210",
        "311221",
        "311225",
        "311224",
        "311230",
        "311300",
        "311410",
        "311420",
        "311513",
        "311514",
        "31151A",
        "311520",
        "311615",
        "31161A",
        "311700",
        "311810",
        "3118A0",
        "311910",
        "311920",
        "311930",
        "311940",
        "311990",
        "312110",
        "312120",
        "312130",
        "312140",
        "312200",
        "313100",
        "313200",
        "313300",
        "314110",
        "314120",
        "314900",
        "315000",
        "316000",
        "322110",
        "322120",
        "322130",
        "322210",
        "322220",
        "322230",
        "322291",
        "322299",
        "323110",
        "323120",
        "324110",
        "324121",
        "324122",
        "324190",
        "325110",
        "325120",
        "325130",
        "325180",
        "325190",
        "325211",
        "3252A0",
        "325411",
        "325412",
        "325413",
        "325414",
        "325310",
        "325320",
        "325510",
        "325520",
        "325610",
        "325620",
        "325910",
        "3259A0",
        "326110",
        "326120",
        "326130",
        "326140",
        "326150",
        "326160",
        "326190",
        "326210",
        "326220",
        "326290",
    ]
    pct = load_bea_use_table().loc[
        pd.Index(allocation_sectors), "325180"
    ]  # Other Basic Inorganic Chemical Manufacturing
    pct = pct / pct.sum()

    emissions = load_recent_trends_in_ghg_emissions_and_sinks().loc[
        ("CO2", "Other Process Uses of Carbonates")
    ]

    allocated = emissions * pct
    return allocated.reindex(CEDA_V7_SECTORS, fill_value=0.0) * MEGATONNE_TO_KG
