# This is the general method reference file for method 1 (Summary)
# Year-specific GHG_national_m1 files import this file to define attribution rules
# that are further customized
# m1 for the GHG national utilizes a summary level sector attribution


!include:CEDA_2025_target.yaml
# year: &ghgi_year 2023
target_naics_year: 2017
geoscale: national

mecs_year: &mecs_year 2018

_attribution_sources:
  EIA_MECS_Energy: &mecs_energy
    year: *mecs_year
    selection_fields: &mecs_energy_default_selection
      Class: Energy # or Other (for non-energy use)
      # Unit: Trillion Btu
      # FlowName: Coal # override this
      Location: '00000'
      Description:
        - Table 2.1 # applies to Class Other - flowsa uses 2.2
        - Table 3.1 # applies to Class Energy - flowsa uses 3.2
    exclusion_fields:
      ActivityConsumedBy: '31-33'
    estimate_suppressed: !script_function:EIA_MECS estimate_suppressed_mecs_energy
    # attribution_method: proportional
    # attribution_source: # Include in main method
    #   BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
    #     <<: *bea_summary
    #     selection_fields:
    #       ActivityProducedBy: {'XXXXX': ''}

  EIA_MECS_Energy_Allocation_CEDA: &mecs_energy_alloc
    activity_to_sector_mapping: CEDA_2025
    year: *mecs_year

  BEA: &bea # 2017 Make and Use tables
    year: 2017
    activity_to_sector_mapping: CEDA_2025
    exclusion_fields:
      # Drop irrelevant final demand and total sectors
      ActivityConsumedBy: ['F03000', 'F04000', 'F05000', 'F02E00',
                           'F06E00', 'F07E00', 'F10E00', 'F02R00',
                           'T001', 'T004', 'T007', 'T019']
      ActivityProducedBy: ['T007', 'T013', 'T015', 'T016', 'TOP',
                           'MCIF']
    attribution_method: equal


source_names:
  EPA_GHGI_T_2_1: #U.S. GHG emissions
    # year: # override this
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      direct:
        selection_fields:
          PrimaryActivity:
            - Abandoned Oil and Gas Wells #CH4 - same as flowsa
            - Abandoned Underground Coal Mines #CH4 - same as flowsa
            - Adipic Acid Production #N2O - same as flowsa
            - Aluminum Production #CO2 - same as flowsa
            - Ammonia Production #CO2 - same as flowsa
            # - Anaerobic Digestion at Biogas Facilities #CH4 new activity # TODO: flowsa code, included in ceda?
            - Caprolactam, Glyoxal, and Glyoxylic Acid Production #N2O - same as flowsa
            # - Carbide Production and Consumption #CO2, CH4 - not in ceda
            - Cement Production #CO2 - same as flowsa
            - Composting #CH4, N2O - same as flowsa
            - Electronics Industry  # N2O - note different than flowsa, which uses T 4_118
            - Ferroalloy Production #CO2, CH4 - note that ch4 in ceda has no emissions to allocate, true of flowsa as well?
            - Glass Production #CO2 - same as flowsa
            - Landfills #CH4 - same as flowsa
            - Incineration of Waste #N2O and CO2
            - Lime Production #CO2 - same as flowsa
            - Iron and Steel Production & Metallurgical Coke Production #CO2, CH4 #TODO: find ch4 in ceda
            - Nitric Acid Production #N2O - same as flowsa
            - Phosphoric Acid Production #CO2 - same as flowsa
            - Rice Cultivation #CH4 - same as flowsa
            - Soda Ash Production #CO2 - ceda pulls this data from table 4-51, but same data
            - Titanium Dioxide Production #CO2 - same as flowsa
            - Wastewater Treatment #CH4, N2O - same as flowsa
            - Zinc Production #CO2 - same as flowsa
          FlowName: ["CO2", "CH4", "N2O"] # HFCs and other flows are pulled elsewhere
        attribution_method: direct
      direct3:
        selection_fields:
          PrimaryActivity:
            - Coal Mining # CH4 only,  co2 coal mining not in ceda
          FlowName: ["CH4"]
        attribution_method: direct

      electricity_transmission:
        selection_fields:
          PrimaryActivity:
#            - Electrical Transmission and Distribution #SF6 - does not exist in ceda, old name?
            - Electrical Equipment #SF6 updated name for this activity in 2024 release - same as flowsa
          FlowName: SF6
        attribution_method: direct

      # updated from flowsa version, which proportionally attributes using BEA Detail Supply, to additionally attribute to gov sectors
      electric_power:
        selection_fields:
          PrimaryActivity:
            Electric Power Sector: Electric Power #CO2 - different attribution than flowsa
        attribution_method: direct

      liming: # liming of agricultural soils - note: flowsa uses proportional by BEA Detail Use SUT
        selection_fields:
          PrimaryActivity: Liming #CO2 - different attribution than flowsa
        attribution_method: direct

      urea:
        selection_fields:
          PrimaryActivity:
            - Urea Consumption for Non-Agricultural Purposes #CO2 - same as flowsa
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'325310': ''} # Fertilizers

      urea_fertilizer:
        selection_fields:
          PrimaryActivity: Urea Fertilization #CO2 - same as flowsa
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'325310': ''} # Fertilizers

      carbonate_use:
        selection_fields:
          PrimaryActivity: Other Process Uses of Carbonates #CO2 - same as flowsa
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef: # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'325180': ''} # Other Basic Inorganic Chemicals

      lead: # todo: why is this not in the "direct" activity set?
        selection_fields:
          PrimaryActivity: Lead Production #CO2 - same as flowsa
        attribution_method: direct

      nitrous_oxide_use:
        selection_fields:
          PrimaryActivity: N2O from Product Uses #N2O - same as flowsa
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'325120': ''} # Industrial gases

#     newly added code for ceda
      fluorochemical:
        selection_fields:
          PrimaryActivity:
          - Fluorochemical Production  # other -  flowsa pulls from EPA_GHGI_T_4_63 and EPA_GHGI_T_4_64
          FlowName:
            HFCs: HFC-23  # ceda assigns HFC type in epa.py
        attribution_method: direct

      electronics_industry:
        selection_fields:
          PrimaryActivity:
          - Electronics Industry  # other -  flowsa pulls from EPA_GHGI_T_4_118
          FlowName:
            HFCs: HFC-23  # ceda assigns HFC type in epa.py
            NF3: NF3
            SF6: SF6
        attribution_method: direct

      # newly added code for ceda, flowsa pulls magnesium from EPA_GHGI_T_4_106
      magnesium:
        selection_fields:
          PrimaryActivity:
          - Magnesium Production and Processing  # other (hfc 134a, sf6)  - different table than flowsa
          FlowName:
            SF6: SF6
            HFCs: HFC-134a  # ceda assigns hfc type in epa.py
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Make_AfterRedef:  # confirmed ceda uses BEA Make
            <<: *bea
            selection_fields:
              ActivityProducedBy:
                '331410': ''
                '331490': ''
                '331520': ''

      field_burning_n2O:
        selection_fields:
          PrimaryActivity:
            - Field Burning of Agricultural Residues
          FlowName: ["N2O"] # ch4 pulled from T_5_29
        attribution_method: proportional
        attribution_source:
          # ceda uses CH4 data to allocate, not n20 data. The n20 data in 5-29 for specific crops is all 0
          EPA_GHGI_T_5_29:
            # year: # override this
            activity_to_sector_mapping: EPA_GHGI_CEDA
            selection_fields:
              PrimaryActivity:
        #        - Chickpeas  # only in flowsa, not in ceda
                - Cotton  # same as flowsa
        #        - Maize  # only in flowsa, not in ceda - same as corn?
                - Rice  # same as flowsa
                - Soybeans  # same as flowsa
                - Wheat  # same as flowsa
                - Corn  # not included in flowsa, only in ceda - same as maize?
                - Lentils  # not included in flowsa, only in ceda
                - Sugarcane  # not included in flowsa, only in ceda
              FlowName:
                CH4: N2O # replacing flow name
            attribution_method: direct

      manure_management_n2O:
        selection_fields:
          PrimaryActivity:
            - Manure Management  # n2O  - different table than flowsa
          FlowName: ["N2O"]  # flowsa pulls ch4 from diff table
        attribution_method: proportional
        attribution_source:
          EPA_GHGI_T_5_7:
            # year: # override this
            activity_to_sector_mapping: EPA_GHGI_CEDA
            selection_fields:
              PrimaryActivity:
                - Beef Cattle  # same as flowsa - n2O, ch4  manure
                - Dairy Cattle  # same as flowsa - n2O, ch4 manure
                - Goats  # same as flowsa - n2O, ch4 manure
                - Horses  # same as flowsa - n2O, ch4 manure
                - Sheep  # same as flowsa - n2O, ch4 manure
                - Swine  # same as flowsa - n2O, ch4 manure
                - Poultry  # same as flowsa - n2O, ch4 manure (not in ceda enteric fermintation)
              FlowName: ["N2O"]
            attribution_method: direct


## Fossil Fuels
  EPA_GHGI_T_3_64: &natgas #CH4 from Natural Gas Systems
    # year: # override this
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity:
        - Distribution  # same as flowsa
#        - Post-Meter  # included in flowsa, not in ceda
#        - Exploration  # included in flowsa, not in ceda
        - Processing  # same as flowsa
        - Production  # same as flowsa
        - Transmission and Storage  # same as flowsa
    attribution_method: direct
  EPA_GHGI_T_3_66: *natgas #CO2 from Natural Gas Systems mimics CH4 - same as flowsa, with exception of diff activities as noted above
#  EPA_GHGI_T_3_68: *natgas #N2O from Natural Gas Systems, not used in original method, mimics CH4 - included in flowsa, not in ceda

# CEDA assigns all emissions to oil extraction (aka production)
  EPA_GHGI_T_3_45: &petroleum #CH4 from Petroleum Systems
    # year: # override this
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity:
        - Crude Oil Transportation: Production
        - Transportation: Production
        - Exploration: Production
        - Production
        - Refining: Production
        - Crude Refining: Production
    attribution_method: direct
#  EPA_GHGI_T_3_49: *petroleum #N2O from Petroleum Systems, not in CEDA

  EPA_GHGI_T_3_47:  #CO2 from Petroleum Systems, does NOT mimic CH4 like in flowsa - same table as flowsa
    # year: # override this
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity:
#        - Crude Oil Transportation - only in flowsa
#        - Transportation - only in flowsa
        - Exploration # - same as flowsa
        - Production # - same as flowsa
#        - Refining - only in flowsa
        - Crude Refining # - same as flowsa
    attribution_method: direct

## Agriculture
  # note - field burning is allocated differently in flowsa. ch4 emissions are pulled from 5_29 and directly attributed.
  # However, n2O data totals are pulled table 2_1 and the T_5_29 data are used to proportionally attribute
  # flowsa only directly attributes data from 5_29, does not use T 2_1 data
  EPA_GHGI_T_5_29: #CH4, N2O, CO and NOx from field burning of residues
    # year: # override this
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      direct_ch4:  # ch4
        selection_fields:
          PrimaryActivity:
    #        - Chickpeas  # only in flowsa, not in ceda
            - Cotton  # same as flowsa
    #        - Maize  # only in flowsa, not in ceda - same as corn?
            - Rice  # same as flowsa
            - Soybeans  # same as flowsa
            - Wheat  # same as flowsa
            - Corn  # not included in flowsa, only in ceda -  same as maize?
            - Lentils  # not included in flowsa, only in ceda
            - Sugarcane  # not included in flowsa, only in ceda
          FlowName: ["CH4"]
        attribution_method: direct

  EPA_GHGI_T_5_3:  &animals #CH4 from Enteric Fermentation
    # year: # override this
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity:  # note: likely not an issue, but flowsa lists the activities for all emissions, while ceda code does not have all activities for all emissions
        - American Bison  # same as flowsa - ch4 manure
        - Beef Cattle  # same as flowsa - n2O, ch4  manure
        - Dairy Cattle  # same as flowsa - n2O, ch4 manure
        - Goats  # same as flowsa - n2O, ch4 manure
        - Horses  # same as flowsa - n2O, ch4 manure
        - Mules and Asses  # same as flowsa, ch4 manure
        - Sheep  # same as flowsa - n2O, ch4 manure
        - Swine  # same as flowsa - n2O, ch4 manure
        - Poultry  # same as flowsa - n2O, ch4 manure (not in ceda enteric fermintation)
    attribution_method: direct
  EPA_GHGI_T_5_7:  # note ceda pulls n2o data from t_2_1 and uses t_5_7 as attribution source, flowsa pulls all from 5_7
    <<: *animals #CH4, mimics enteric fermentation
    selection_fields:
      FlowName: ["CH4"]  # n2o loaded from T 2_1

  EPA_GHGI_T_5_18: #Direct N2O emissions from agricultural soils
    # year: # override this
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      fertilizer_use:
        selection_fields:
          PrimaryActivity:
            - Organic Amendment Cropland  # same as flowsa
            - Residue N Cropland  # same as flowsa
            - Synthetic Fertilizer Cropland  # same as flowsa
        attribution_method: proportional  # note - different than flowsa, which uses direct attribution
        attribution_source:
          BEA_Detail_Use_AfterRedef:
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'325310': ''} # fertilizer sectors

      # flowsa uses direct attribution, ceda proportionally attributes
      cropland:
        selection_fields:
          PrimaryActivity:
            - Mineralization and Asymbiotic Fixation Cropland
            - Drained Organic Soils Cropland
        attribution_method: proportional
        attribution_source:
          USDA_CoA_Cropland_CEDA:
            year: 2018
            attribution_method: equal

      # note different than flowsa - flows directly attributes, while ceda uses hard coded 2018 coa data
      pasture: &pasture
        selection_fields:
          PrimaryActivity:
            - All activities Grassland
        attribution_method: proportional
        attribution_source:
          USDA_CoA_Livestock_CEDA:
            year: 2018
            attribution_method: equal


  EPA_GHGI_T_5_19: #Indirect N2O emissions from agricultural soils
    # year: # override this
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      fertilizer_use:
        selection_fields:
          PrimaryActivity:
            - Volatilization & Atm. Deposition Cropland  # same as flowsa
            - Surface Leaching & Run-Off Cropland  # same as flowsa
        attribution_method: proportional  # note different than flowsa, which uses direct
        attribution_source:
          BEA_Detail_Use_AfterRedef:
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'325310': ''} # fertilizer sectors
      pasture:
        selection_fields:
          PrimaryActivity:
            - All activities Grassland
        attribution_method: proportional
        attribution_source:
          USDA_CoA_Livestock_CEDA:
            year: 2018
            attribution_method: equal


### Mobile Sources
  EPA_GHGI_T_3_13: #CO2 from mobile combustion
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      direct_petroleum:
        selection_fields:
          PrimaryActivity:
            Buses LPG: Buses
            Ships and Non-Recreational Boats Residual Fuel Oil: Ships and Non-Recreational Boats
            Medium- and Heavy-Duty Trucks LPG: Medium- and Heavy-Duty Trucks
            Medium- and Heavy-Duty Trucks Natural Gas: Medium- and Heavy-Duty Trucks
            Light-Duty Trucks LPG: Light-Duty Trucks - Households
            Passenger Cars LPG: Passenger Cars - Households
        attribution_method: direct

      direct_jet:
        selection_fields:
          PrimaryActivity:
            General Aviation Aircraft Aviation Gasoline: General Aviation Aircraft
            General Aviation Aircraft Jet Fuel: General Aviation Aircraft
            Commercial Aircraft Jet Fuel: Commercial Aircraft
            Military Aircraft Jet Fuel: Military Aircraft
        attribution_method: direct

      direct_ng:
        selection_fields:
          PrimaryActivity:
            Buses Natural Gas: Pipeline Natural Gas # all natural gas allocated to pipelines in CEDA
            Pipeline Natural Gas: Pipeline Natural Gas
        attribution_method: direct

      petroleum_fuels_diesel:
        selection_fields:
          PrimaryActivity: # lump all data together before allocating
            # These should be direct
            Rail Distillate Fuel Oil: All Transport - Diesel
            Recreational Boats Distillate Fuel Oil: All Transport - Diesel
            Ships and Non-Recreational Boats Distillate Fuel Oil: All Transport - Diesel
            # These should be proportional
            Medium- and Heavy-Duty Trucks Distillate Fuel Oil: All Transport - Diesel
            Buses Distillate Fuel Oil: All Transport - Diesel
            Passenger Cars Distillate Fuel Oil: All Transport - Diesel
            Light-Duty Trucks Distillate Fuel Oil: All Transport - Diesel
        attribution_method: proportional
        attribution_source:
          BEA_CEDA_transport_allocation:
            activity_to_sector_mapping: CEDA_2025
            year: 2023
            selection_fields:
              FlowName: Distillate Fuel Oil

      petroleum_fuels_gasoline:
        selection_fields:
          PrimaryActivity: # lump all data together before allocating
            # These should be direct
            Medium- and Heavy-Duty Trucks Gasoline: All Transport - Gasoline
            Buses Gasoline: All Transport - Gasoline
            Motorcycles Gasoline: All Transport - Gasoline
            Recreational Boats Gasoline: All Transport - Gasoline
            # These should be proportional
            Passenger Cars Gasoline: All Transport - Gasoline
            Light-Duty Trucks Gasoline: All Transport - Gasoline
        attribution_method: proportional
        attribution_source:
          BEA_CEDA_transport_allocation:
            activity_to_sector_mapping: CEDA_2025
            year: 2023
            selection_fields:
              FlowName: Motor Gasoline

  EPA_GHGI_T_3_14: #CH4 from mobile combustion
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    activity_sets: &mobile
      direct_gasoline: # empty in some years (<0.05 MMT CO2eq)
        selection_fields:
          PrimaryActivity:
            Motorcycles Gasoline On-Road: Motorcycles
            Medium- and Heavy-Duty Trucks and Buses Gasoline On-Road: Medium- and Heavy-Duty Trucks and Buses
        attribution_method: direct

      direct_non_road:
        selection_fields:
          PrimaryActivity:
            Rail Non-Road: Rail
            Ships and Boats Non-Road: Ships and Boats
            Aircraft Non-Road: General Aviation Aircraft
        attribution_method: direct

      # # Missing from CEDA for CH4
      # petroleum_fuels_diesel:
      #   selection_fields:
      #     PrimaryActivity:
      #       Passenger Cars Diesel On-Road: Passenger Cars - Households # needs to be household only in CEDA
      #       Light-Duty Trucks Diesel On-Road: Light-Duty Trucks - Households # needs to be household only in CEDA
      #       Medium- and Heavy-Duty Buses Diesel On-Road: Medium- and Heavy-Duty Trucks and Buses # assigned to to 484 only in CEDA
      #       Medium- and Heavy-Duty Trucks Diesel On-Road: Medium- and Heavy-Duty Trucks - Distillate Fuel Oil
      #   attribution_method: direct

      petroleum_fuels_gasoline:
        selection_fields:
          PrimaryActivity:
            Passenger Cars Gasoline On-Road: Passenger Cars - Households # needs to be household only in CEDA
            Light-Duty Trucks Gasoline On-Road: Light-Duty Trucks - Households # needs to be household only in CEDA
        attribution_method: direct
        # attribution_source:
        #   BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
        #     <<: *bea
        #     selection_fields:
        #       ActivityProducedBy: {'324110': ''} # purchases of refinery products

      construction_and_mining: #this set is allocated by purchases of construction equipment
        selection_fields:
          PrimaryActivity: Construction/Mining Equipment Non-Road
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'333120': ''} # purchases of construction/mining equipment

      farm_non_road: #this set is allocated by purchases of farm machinery
        selection_fields:
          PrimaryActivity: Agricultural Equipment Non-Road
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'333111': ''} # purchases of farm machinery

      other_non_road: #this set is allocated by purchases of petroleum refining
        selection_fields:
          PrimaryActivity: Other Non-Road
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef: # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'324110': ''} # purchases of refinery products

    # NOTE THIS ACTIVITY SET IS NOT INCLUDED FOR N2O in CEDA (but is for CH4)
      alt_fuel_on_road: #this set is allocated by purchases of natural gas
        selection_fields: # empty in some years (<0.05 MMT CO2eq)
          PrimaryActivity:
            All activities Alternative Fuel On-Road: Alternative Fuel On-Road
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'221200': ''} # purchases of natural gas

  EPA_GHGI_T_3_15: #N2O from mobile combustion duplicates method for CH4
  # except for some errors (N2O is missing alt_fuel while CH4 is missing petroleum diesel)
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      <<: *mobile
      petroleum_fuels_diesel:
        selection_fields:
          PrimaryActivity:
            Passenger Cars Diesel On-Road: Passenger Cars - Households # needs to be household only in CEDA
            Light-Duty Trucks Diesel On-Road: Light-Duty Trucks - Households # needs to be household only in CEDA
            Medium- and Heavy-Duty Buses Diesel On-Road: Medium- and Heavy-Duty Trucks and Buses # assigned to to 484 only in CEDA
            Medium- and Heavy-Duty Trucks Diesel On-Road: Medium- and Heavy-Duty Trucks # assigned to 484 only in CEDA
        attribution_method: direct
      alt_fuel_on_road:
        selection_fields: # empty in some years (<0.05 MMT CO2eq)
          PrimaryActivity: Skip me # need to bypass this activity set to skip it.

## Stationary Combustion
  GHGI_CO2_stationary_combustion: # CO2 emissions from stationary combustion
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    # year: # override this
    clean_fba_before_activity_sets: !script_function:EPA_GHGI allocate_industrial_combustion
    clean_parameter: # Override each year for use in allocate_industrial_combustion
        energy_fba: 'EIA_MECS_Energy'
        year: *mecs_year
        # ghgi_year: *ghgi_year # CEDA uses the GHGI year not the MECS year
        ghg_fba: 'EPA_GHGI_T_A_5' # to align with ghgi year, use 'EPA_GHGI_T_A_10' for 2018 Table
    activity_sets:
      direct_attribution: #direct allocation
        selection_fields:
          PrimaryActivity: Total (All Fuels) Residential
        attribution_method: direct

      non_manufacturing_coal:
        selection_fields:
          PrimaryActivity:
            Commercial Coal Commercial: Coal Commercial  # same as flowsa
            Industrial Other Coal Industrial: Coal Industrial  # todo: re examine
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'212100': ''} # purchases of coal

      non_manufacturing_natural_gas: # Applies to non-manufacturing sectors like ag and mining
        selection_fields:
          PrimaryActivity:
            - Natural Gas Commercial # same as flowsa
            - Natural Gas Industrial  # todo: re examine
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'221200': ''} # purchases of natural gas


      coal_manufacturing_co2: # Industrial Coal for Manufacturing
        selection_fields:
          PrimaryActivity:
            Industrial Other Coal Industrial - Manufacturing: Coal Industrial - Manufacturing
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Coal
              Description: 'energy'


      natural_gas_manufacturing: # Industrial Natural Gas for manufacturing
        selection_fields:
          PrimaryActivity:
            - Natural Gas Industrial - Manufacturing
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Natural Gas
              Description: 'energy'

      petroleum_industrial: # Petroleum
        selection_fields:
          PrimaryActivity:
            - Total Petroleum Industrial
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Petroleum
              Description: 'energy'

      petroleum_commercial: # Petroleum
        selection_fields:
          PrimaryActivity:
            - Total Petroleum Commercial  # same as flowsa
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'324110': ''} # purchases of refinery products

  EPA_GHGI_T_3_8:  &stationary_combustion # CH4 emissions from stationary combustion
    # year: #override this with ghgi_year
    activity_to_sector_mapping: EPA_GHGI_CEDA
    # note - below clean function splits ghgi data into manufacturing and non manufacturing
    # while ceda does not originally use this terminology/append "manufacturing" to activity names, ceda
    # accomplishes the same methods through
    # _allocate_industrial_coal_to_industries_energy_allocation() + _allocate_remaining_industrial_coal_usage()
    clean_fba_before_activity_sets: !script_function:EPA_GHGI allocate_industrial_combustion
    clean_parameter: # Override each year for use in allocate_industrial_combustion
        energy_fba: 'EIA_MECS_Energy'  # todo: udpate for ceda to mecs table 3-1?
        year: *mecs_year
        # ghgi_year: *ghgi_year # CEDA uses the GHGI year not the MECS year
        ghg_fba: 'EPA_GHGI_T_A_5' # to align with ghgi year, use 'EPA_GHGI_T_A_10' for 2018 Table
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      # todo: check if this has any impact. in ceda, no ch4 emissions, but there are n2O emissions. likely keep code as is
      residential:
        selection_fields:
          PrimaryActivity:
            - Fuel Oil Residential
            - Coal Residential
            - Natural Gas Residential
            - Wood Residential
        attribution_method: direct

     # note modified approach from flowsa - ceda directly attributes, while flowsa proportionally attributes using bea
      electric_power:
        selection_fields:
          # note: for ceda calling on all activities, but this is the same approach as flowsa as the electricity by fuel type sum to all activities
          PrimaryActivity:
#            Coal Electric Power: Coal Electric Power  # flowsa only
#            Natural Gas Electric Power: Natural Gas Electric Power  # flowsa only
#            Natural gas Electric Power: Natural Gas Electric Power # fix capitalization  # flowsa only
#            Fuel Oil Electric Power: Fuel Oil Electric Power  # flowsa only
#            Wood Electric Power: Wood Electric Power
            - All activities Electric Power
        attribution_method: direct

      # updated from flowsa, only includes commercial
      fuel_oil_commercial:
        selection_fields:
          PrimaryActivity:
            - Fuel Oil Commercial  # same as flowsa
#            - Fuel Oil Industrial  # only in flowsa, industrial moved to new code below
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'324110': ''}  # purchases of refinery products

      # new code for industrial
      fuel_oil_industrial:
        selection_fields:
          PrimaryActivity:
            - Fuel Oil Industrial
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Petroleum
              Description: 'energy'

      natural_gas_nonmanufacturing:  # Commercial Natural gas
        selection_fields:
          PrimaryActivity:
            Natural gas Commercial: Natural Gas Commercial # fix capitalization - same as flowsa
            Natural gas Industrial: Natural Gas Industrial # fix capitalization
            Natural Gas Commercial: Natural Gas Commercial
            Natural Gas Industrial: Natural Gas Industrial
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'221200': ''}  # purchases of natural gas

      # note - this replicates _allocate_remaining_industrial_coal_usage()
      coal_nonmanufacturing: # empty in some years (i.e., all coal consumption for manufacturing)
        selection_fields:
          PrimaryActivity: Coal Industrial
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Use_AfterRedef:  # flowsa uses BEA_SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'212100': ''}  # purchases of coal

      # ceda splits coal into manufacturing/non manufacturing, but did not update the activity names, same method
      coal_manufacturing:
        selection_fields:
          PrimaryActivity: Coal Industrial - Manufacturing
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Coal
              Description: 'energy'

      # ceda accomplishes similar through
      # _allocate_industrial_nat_gas_to_industries_energy_allocation() + _allocate_remaining_industrial_nat_gas_usage()
      ng_manufacturing:
        selection_fields:
          PrimaryActivity:
            - Natural gas Industrial - Manufacturing
            - Natural Gas Industrial - Manufacturing  # only in flowsa, CEDA does not call on manufacturing
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Natural Gas
              Description: "energy"

    #Intentionally left out 'Wood Commercial' and 'Wood Industrial'  # flowsa note, but ceda also does not include

  EPA_GHGI_T_3_9: *stationary_combustion # N2O emissions from stationary combustion


## Other sources
  EPA_GHGI_T_4_55: #CO2 for selected petrochemicals
    # year: # override with ghgi_year
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity:
        - Acrylonitrile  # same as flowsa
        - Carbon Black  # same as flowsa
        - Ethylene  # same as flowsa
#        - Ethylene Dichloride  # only in flowsa
        - Ethylene Oxide  # same as flowsa
        - Methanol  # same as flowsa
    attribution_method: direct

  GHGI_nonenergy_fossil_fuel_emissions: # Fossil fuel for non-energy uses
    # year: #override with ghgi_year
    fedefl_mapping: GHGI_AR5_100
    activity_sets:
      coal:
        selection_fields:
          PrimaryActivity:
            - Industry Industrial Coking Coal  # same as flowsa
            - Industry Industrial Other Coal  # same as flowsa
        attribution_method: direct

      petroleum_neu: # consumed petroleum products
        selection_fields:
          PrimaryActivity:
            'Industry Asphalt & Road Oil': Industry Petroleum Products Non-energy  # same as flowsa
            Industry Distillate Fuel Oil: Industry Petroleum Products Non-energy  # same as flowsa
#            Industry LPG: Industry Petroleum Products Non-energy  #not in 2023 ghg, this is the same as HGL in 2018
            Industry Lubricants: Industry Petroleum Products Non-energy  # same as flowsa
            Industry Miscellaneous Products: Industry Petroleum Products Non-energy  # same as flowsa
            'Industry Naphtha (<401 F)': Industry Petroleum Products Non-energy  # same as flowsa
            'Industry Other Oil (>401 F)': Industry Petroleum Products Non-energy  # same as flowsa
#            Industry Pentanes Plus: Industry Petroleum Products Non-energy #not in 2023 ghg, this is the same as HGL in 2018
            Industry Petroleum Coke: Industry Petroleum Products Non-energy  # same as flowsa
            Industry Special Naphtha: Industry Petroleum Products Non-energy  # same as flowsa
            Industry Still Gas: Industry Petroleum Products Non-energy  # same as flowsa
            Industry Waxes: Industry Petroleum Products Non-energy  # same as flowsa
            Industry Natural Gasoline: Industry Petroleum Products Non-energy #T_3_22. Also produced by nat gas plants  # same as flowsa
            Industry HGL: Industry Petroleum Products Non-energy #T_3_22. Also produced by nat gas plants  # same as flowsa
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Petroleum
              Description: "non energy"

      # todo: update to proportionally attribute using mecs 2-1 and bea - although is allocating by bea necessary for fbs?
      natural_gas_neu: # consumed nat gas to chemical plants
        selection_fields:
          PrimaryActivity: Industry Natural Gas to Chemical Plants
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Natural Gas
              Description: "non energy"

      transportation_lubricants:
        selection_fields:
          PrimaryActivity: Transportation Lubricants  # todo: determine if this is the same as ("Transportation", "TOTAL") in ceda
        attribution_method: proportional
        attribution_source:
          EIA_MECS_Energy_Allocation_CEDA:
            <<: *mecs_energy_alloc
            selection_fields:
              FlowName: Transport
              Description: "non energy"

## Other Emissions
  EPA_GHGI_T_4_59: # HFCs from HCFC-22 production
    # year: # override with ghgi_year
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity: HCFC-22 Production
    attribution_method: direct

# note - below code is how flowsa handles fluorochemical production
#  EPA_GHGI_T_4_63: # Fluorochemical production (in CO2e)
#    # year: # override with ghgi_year
#    fedefl_mapping: GHGI_AR5_100
#    selection_fields:
#      PrimaryActivity: Fluorochemical Production
#      FlowName: ["Other PFCs", "Other HFCs"]
#    attribution_method: direct
#
#  EPA_GHGI_T_4_64: # Fluorochemical production (in MT)
#    # year: # override with ghgi_year
#    fedefl_mapping: GHGI_AR5_100
#    selection_fields:
#      PrimaryActivity: Fluorochemical Production
#    exclusion_fields:
#      FlowName: ["Other PFCs", "Other HFCs"]
#    attribution_method: direct

  EPA_GHGI_T_4_118: # HFCs and other emissions from electronics manufacture
    # year: # override with ghgi_year
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity:
#        - Electronics Industry  # ceda pulls from t_2_1 and directly attributes, moving there
        - Semiconductors  # pfcs - same as flowsa
        - PV
        - MEMS
    attribution_method: direct

  # EPA_GHGI_T_4_132: # SF6 and PFCs from Other Product Use
  #   # year: # override with ghgi_year
  #   activity_to_sector_mapping: EPA_GHGI_CEDA
  #   fedefl_mapping: GHGI_AR5_100
  #   attribution_method: direct

  EPA_GHGI_T_4_124: # HFCs and PFCs from ODS Substitutes
    activity_to_sector_mapping: EPA_GHGI_CEDA
    clean_fba_before_activity_sets: !script_function:EPA_GHGI split_HFCs_by_type
    clean_parameter:
        # Proportions of specific HFCs are assigned based on national total
        flow_fba: EPA_GHGI_T_4_122
    # year: # override with ghgi_year
    fedefl_mapping: GHGI_AR5_100
    activity_sets:

      # todo: need to subtract out "total" from table A-90
      # todo: add activyt to mapping file
      refrigerants_AC:
        selection_fields:
          PrimaryActivity:
            - Refrigeration/Air Conditioning
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Make_AfterRedef:  # confirmed ceda uses make, flowsa uses bea SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy: {'333415': ''} # Air conditioning equipment

      foams:
        selection_fields:
          PrimaryActivity:
            - Foams
        attribution_method: proportional
        attribution_source:
          BEA_Detail_Make_AfterRedef:  # confirmed ceda uses make table - flowsa uses SUT
            <<: *bea
            selection_fields:
              ActivityProducedBy:
                '326140': '' # Polystyrene foam  - same as flowsa
                '326150': '' # Urethane and other foam  - same as flowsa


  EPA_GHGI_T_A_90: # HFCs from Transportation
    # year: # override with ghgi_year
    activity_to_sector_mapping: EPA_GHGI_CEDA
    clean_fba_before_mapping: !script_function:EPA_GHGI split_HFCs_by_type
    clean_parameter:
        # Proportions of specific HFCs are assigned based on national total
        flow_fba: EPA_GHGI_T_4_122
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity:
#        Mobile AC - Passenger Cars: Passenger Cars - Households  # only in flowsa, note in ceda to consider
#        Mobile AC - Light-Duty Trucks: Light-Duty Trucks - Households  # only in flowsa, note in ceda to consider
        Mobile AC - Heavy-Duty Vehicles: Heavy-Duty Vehicles  # same as flowsa
        Comfort Cooling for Trains and Buses - School and Tour Buses: School and Tour Buses  # same as flowsa
        # Comfort Cooling for Trains and Buses - Transit Buses: Transit Buses #excluded in flowsa too # only in flowsa
#        Comfort Cooling for Trains and Buses - Rail: Rail  # only in flowsa
        Refrigerated Transport - Medium- and Heavy-Duty Trucks: Medium- and Heavy-Duty Trucks  # same as flowsa
        Refrigerated Transport - Rail: Rail  # same as flowsa
        Refrigerated Transport - Ships and Boats: Ships and Boats  # same as flowsa
    attribution_method: direct


  EPA_GHGI_T_4_100: # PFCs from aluminum production
    # year: # override with ghgi_year
    activity_to_sector_mapping: EPA_GHGI_CEDA
    fedefl_mapping: GHGI_AR5_100
    selection_fields:
      PrimaryActivity: Aluminum Production  # same as flowsa
    attribution_method: direct


# note - below code is flowsa, ceda proportionally attributes from T 2_1
#  EPA_GHGI_T_4_106: # HFCs, SF6, CO2 from magnesium production
#    # year: # override with ghgi_year
#    fedefl_mapping: GHGI_AR5_100
#    selection_fields:
#      PrimaryActivity: Magnesium Production and Processing
#    attribution_method: direct
